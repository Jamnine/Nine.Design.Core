<UserControl
    x:Class="Nine.Design.PollingTool.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:LayoutControl="clr-namespace:Nine.Design.Clientbase;assembly=Nine.Design.Clientbase"
    xmlns:cmd="clr-namespace:Nine.Design.Clientbase;assembly=Nine.Design.Clientbase"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
    xmlns:local="clr-namespace:Nine.Design.PollingTool"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ndcui="clr-namespace:Nine.Design.UI;assembly=Nine.Design.UI"
    xmlns:pu="clr-namespace:Panuon.WPF.UI;assembly=Panuon.WPF.UI"
    xmlns:pucore="clr-namespace:Panuon.WPF;assembly=Panuon.WPF"
    xmlns:pul="https://opensource.panuon.com/wpf-ui"
    xmlns:purs="clr-namespace:Panuon.WPF.UI.Resources;assembly=Panuon.WPF.UI"
    MinWidth="1000"
    MinHeight="600"
    pu:ScrollBarHelper.HoverThumbBackground="{DynamicResource ThemeBrush}"
    pu:ScrollBarHelper.ThumbBackground="{DynamicResource ThemeBrushTrans6}"
    SizeChanged="MetroWindow_SizeChanged"
    mc:Ignorable="d">

    <!--  全局样式统一：保留原有主题色 + 适配Panuon控件  -->
    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <!--  新项目原有资源字典  -->
                <ResourceDictionary>
                    <pu:ToastSettings x:Key="toastSetting" Spacing="0">
                        <pu:ToastSettings.LabelStyle>
                            <Style BasedOn="{StaticResource {x:Static pu:Toast.LabelStyleKey}}" TargetType="Label">
                                <Setter Property="Background" Value="#ffb7c5" />
                                <Setter Property="Foreground" Value="#FFFFFF" />
                                <Setter Property="pu:LabelHelper.CornerRadius" Value="15" />
                                <Setter Property="pu:LabelHelper.ShadowColor" Value="#ffb7c5" />
                                <Setter Property="pu:ShadowHelper.Opacity" Value="0.3" />
                            </Style>
                        </pu:ToastSettings.LabelStyle>
                    </pu:ToastSettings>
                </ResourceDictionary>
                <ResourceDictionary>
                    <FontFamily x:Key="PanuonIconFont">/Panuon.WPF.UI;component/Resources/Fonts/#PanuonIcon</FontFamily>
                </ResourceDictionary>
                <pul:StyleDictionary Includes="All" />
                <ResourceDictionary Source="pack://application:,,,/Nine.Design.UI;component/Styles/ToggleButtonStyle.xaml" />
                <ResourceDictionary Source="pack://application:,,,/Nine.Design.UI;component/Styles/SearchBoxStyle.xaml" />
                <ResourceDictionary Source="pack://application:,,,/Nine.Design.UI;component/Styles/LabelStyle.xaml" />
                <ResourceDictionary Source="pack://application:,,,/Nine.Design.UI;component/Styles/PasswordBoxStyle.xaml" />
                <ResourceDictionary Source="pack://application:,,,/Nine.Design.UI;component/Styles/GroupBoxStyle.xaml" />
                <ResourceDictionary Source="pack://application:,,,/Nine.Design.UI;component/Styles/ComboBoxStyle.xaml" />
                <ResourceDictionary Source="pack://application:,,,/Nine.Design.UI;component/Styles/TextBoxStyle.xaml" />
                <ResourceDictionary Source="pack://application:,,,/Nine.Design.UI;component/Styles/DropDownStyle.xaml" />
                <ResourceDictionary Source="pack://application:,,,/Nine.Design.UI;component/Styles/ButtonStyle.xaml" />
                <ResourceDictionary Source="pack://application:,,,/Nine.Design.UI;component/Styles/ListBoxStyle.xaml" />
                <ResourceDictionary Source="pack://application:,,,/Nine.Design.UI;component/Themes/Light.xaml" />
                <ResourceDictionary Source="pack://application:,,,/Nine.Design.UI;component/Styles/TrayMenuItemStyle.xaml" />
                <ResourceDictionary Source="pack://application:,,,/Nine.Design.UI;component/Styles/CirclePointRingLoading.xaml" />
            </ResourceDictionary.MergedDictionaries>

            <!--  原有主题色（保留不变）  -->
            <SolidColorBrush x:Key="PrimaryColor" Color="BurlyWood" />
            <SolidColorBrush x:Key="SecondaryColor" Color="#3498DB" />
            <SolidColorBrush x:Key="SuccessColor" Color="#2ECC71" />
            <SolidColorBrush x:Key="WarningColor" Color="#F39C12" />
            <SolidColorBrush x:Key="DangerColor" Color="#E74C3C" />
            <SolidColorBrush x:Key="NeutralColor" Color="#ECF0F1" />
            <SolidColorBrush x:Key="TextPrimaryColor" Color="#2C3E50" />
            <SolidColorBrush x:Key="TextSecondaryColor" Color="#7F8C8D" />

            <!--  通用样式 - 改为相对尺寸 + 适配Panuon控件  -->
            <Style x:Key="LabelStyle" TargetType="TextBlock">
                <Setter Property="Foreground" Value="{StaticResource TextSecondaryColor}" />
                <Setter Property="FontSize" Value="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=9}" />
                <Setter Property="Margin" Value="0,0,5,3" />
            </Style>

            <Style x:Key="InputStyle" TargetType="TextBox">
                <Setter Property="Padding" Value="8" />
                <Setter Property="BorderThickness" Value="1" />
                <Setter Property="BorderBrush" Value="{StaticResource SecondaryColor}" />
                <Setter Property="FontSize" Value="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=9}" />
                <Setter Property="Margin" Value="0,3,0,5" />
                <Setter Property="VerticalContentAlignment" Value="Top" />
                <!--  替换MahApps附加属性为Panuon对应实现  -->
                <Setter Property="pu:TextBoxHelper.CornerRadius" Value="4" />
                <Setter Property="pu:TextBoxHelper.FocusedBorderBrush" Value="{StaticResource PrimaryColor}" />
                <Style.Triggers>
                    <Trigger Property="IsFocused" Value="True">
                        <Setter Property="BorderBrush" Value="{StaticResource PrimaryColor}" />
                    </Trigger>
                </Style.Triggers>
            </Style>

            <Style x:Key="ButtonStyle" TargetType="Button">
                <Setter Property="Background" Value="{StaticResource SecondaryColor}" />
                <Setter Property="Foreground" Value="White" />
                <Setter Property="BorderThickness" Value="0" />
                <Setter Property="Padding" Value="12,6" />
                <Setter Property="FontSize" Value="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=9}" />
                <Setter Property="FontWeight" Value="Medium" />
                <Setter Property="Margin" Value="0,0,8,0" />
                <!--  增加Panuon按钮圆角样式  -->
                <Setter Property="pu:ButtonHelper.CornerRadius" Value="4" />
                <Style.Triggers>
                    <Trigger Property="IsMouseOver" Value="True">
                        <Setter Property="Background" Value="{StaticResource PrimaryColor}" />
                        <Setter Property="Cursor" Value="Hand" />
                    </Trigger>
                    <Trigger Property="IsPressed" Value="True">
                        <Setter Property="Background" Value="#1A5276" />
                    </Trigger>
                    <Trigger Property="IsEnabled" Value="False">
                        <Setter Property="Background" Value="{StaticResource TextSecondaryColor}" />
                        <Setter Property="Foreground" Value="LightGray" />
                    </Trigger>
                </Style.Triggers>
            </Style>

            <!--  机器过滤按钮样式（新增）  -->
            <!--  抽离后的 MachineFilterButtonStyle 样式（包含 btnAllLogs 的所有样式属性）  -->
            <!--  1. 先补充基础ButtonStyle（确保按钮基础外观）  -->
            <Style x:Key="BaseButtonStyle" TargetType="Button">
                <Setter Property="Foreground" Value="Black" />
                <!--  字体颜色（对应截图的黑色）  -->
                <Setter Property="Background" Value="{StaticResource PrimaryColor}" />
                <!--  背景色（对应截图的棕色）  -->
                <Setter Property="BorderThickness" Value="1" />
                <!--  边框（对应截图的灰色边框）  -->
                <Setter Property="BorderBrush" Value="#888888" />
                <!--  边框颜色  -->
                <Setter Property="HorizontalContentAlignment" Value="Center" />
                <Setter Property="VerticalContentAlignment" Value="Center" />
                <Setter Property="Cursor" Value="Hand" />
            </Style>

            <!--  2. 修正后的MachineFilterButtonStyle（继承基础样式+补全属性）  -->
            <!--  修正后的 MachineFilterButtonStyle：必须基于 Panuon 的 ButtonStyle  -->
            <Style
                x:Key="MachineFilterButtonStyle"
                BasedOn="{StaticResource {x:Type Button}}"
                TargetType="Button">
                <!--  1. 布局属性（和原按钮完全一致）  -->
                <Setter Property="Height" Value="20" />
                <Setter Property="MinWidth" Value="65" />
                <Setter Property="MaxWidth" Value="140" />
                <Setter Property="Margin" Value="0,0,10,0" />

                <!--  2. 基础外观（继承 Panuon 后，这里只需要覆盖差异）  -->
                <Setter Property="Background" Value="{StaticResource PrimaryColor}" />
                <Setter Property="Foreground" Value="Black" />
                <!--  确保字体颜色和原按钮一致  -->
                <Setter Property="BorderThickness" Value="0" />
                <!--  原按钮的边框  -->
                <Setter Property="BorderBrush" Value="#888888" />
                <!--  原按钮的边框颜色  -->

                <!--  3. 字体属性（保留自适应绑定）  -->
                <Setter Property="FontSize" Value="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=9}" />

                <!--  4. Panuon 附加属性（核心：现在能生效了，因为继承了基础样式）  -->
                <!--  ButtonHelper：圆角、图标、阴影颜色  -->
                <Setter Property="pu:ButtonHelper.CornerRadius" Value="4" />
                <Setter Property="pu:ButtonHelper.Icon" Value="&#xe93d;" />
                <!--  原图标编码  -->
                <Setter Property="pu:ButtonHelper.ShadowColor" Value="#2ECC71" />
                <!--  原阴影颜色  -->

                <!--  IconHelper：图标字体、大小、边距（确保图标显示正确）  -->
                <Setter Property="pu:IconHelper.FontFamily" Value="{StaticResource PanuonIconFont}" />
                <!--  必须确保这个资源存在  -->
                <Setter Property="pu:IconHelper.FontSize" Value="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=9}" />
                <Setter Property="pu:IconHelper.Margin" Value="0,0,5,0" />
                <!--  图标和文字的间距  -->

                <!--  ShadowHelper：阴影模糊、深度（确保阴影显示正确）  -->
                <Setter Property="pu:ShadowHelper.BlurRadius" Value="10" />
                <Setter Property="pu:ShadowHelper.ShadowDepth" Value="3" />
            </Style>
            <!--<Style
                x:Key="MachineFilterButtonStyle"
                BasedOn="{StaticResource ButtonStyle}"
                TargetType="Button">
                <Setter Property="Padding" Value="10,4" />
                <Setter Property="Margin" Value="0,0,5,0" />
                <Setter Property="MinWidth" Value="80" />
                <Setter Property="MaxWidth" Value="120" />
            -->
            <!--<Style.Triggers>
                    <Trigger Property="IsChecked" Value="True">
                        <Setter Property="Background" Value="{StaticResource PrimaryColor}" />
                        <Setter Property="Foreground" Value="White" />
                    </Trigger>
                </Style.Triggers>-->
            <!--
            </Style>-->
        </ResourceDictionary>
    </UserControl.Resources>

    <!--  保留原有布局结构，移除TabControl，新增机器过滤按钮和全局日志ListBox  -->
    <Grid Background="#FAFAFA">
        <Grid.RowDefinitions>
            <RowDefinition Height="50" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!--  顶部标题栏 - 相对高度（保留不变）  -->
        <Grid
            Grid.Row="0"
            Height="50"
            VerticalAlignment="Center"
            Background="{StaticResource PrimaryColor}">
            <StackPanel
                Margin="20,0,0,0"
                HorizontalAlignment="Left"
                VerticalAlignment="Center">
                <TextBlock
                    FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=13}"
                    FontWeight="Bold"
                    Foreground="White"
                    Text="轮询接口测试工具" />
                <TextBlock
                    Margin="0,2,0,0"
                    FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=8}"
                    Foreground="#E0E0E0"
                    Text="高性能多机器轮询 | 实时统计监控 | 单面板日志过滤" />
            </StackPanel>
        </Grid>

        <!--  主内容区域（避开标题栏）  -->
        <Grid
            Grid.Row="1"
            Grid.ColumnSpan="2"
            Margin="9">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <!--  参数配置行  -->
                <RowDefinition Height="*" />
                <!--  功能按钮行  -->
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!--  第一行：参数配置区域 - 自适应宽度（保留不变）  -->
            <Grid Grid.Column="0" Margin="0,0,0,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="7*" />
                    <ColumnDefinition Width="5" />
                    <ColumnDefinition Width="3*" />
                </Grid.ColumnDefinitions>
                <GroupBox
                    Grid.Column="0"
                    pu:GroupBoxHelper.CornerRadius="9"
                    pu:GroupBoxHelper.HeaderBackground="#FFD0DDEE"
                    pu:GroupBoxHelper.HeaderBorderBrush="#00FFFFFF"
                    pu:GroupBoxHelper.HeaderCornerRadius="8,8,0,0"
                    pu:GroupBoxHelper.HeaderFontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=11}"
                    pu:GroupBoxHelper.HeaderHeight="35"
                    pu:GroupBoxHelper.HeaderHorizontalContentAlignment="Left"
                    pu:GroupBoxHelper.HeaderPadding="7,0,0,0"
                    BorderBrush="#FFD0DDEE"
                    Header="基础参数">
                    <Grid Grid.Row="0" Background="White">
                        <!--  左侧：基础参数  -->
                        <StackPanel>
                            <!--  频率/机器数/请求方法 - 自适应布局  -->
                            <Grid MinWidth="280">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="7*" />
                                    <ColumnDefinition Width="10" />
                                    <ColumnDefinition Width="2.5*" />
                                    <ColumnDefinition Width="10" />
                                    <ColumnDefinition Width="1.5*" />
                                    <ColumnDefinition Width="10" />
                                    <ColumnDefinition Width="2*" />
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="2*" MinHeight="50" />
                                    <RowDefinition Height="8*" MinHeight="120" />
                                </Grid.RowDefinitions>
                                <StackPanel Grid.Row="0" Grid.Column="0">
                                    <!--  轮询地址 - 自适应高度（替换MahApps Watermark为Panuon）  -->
                                    <TextBlock
                                        Margin="0,0,0,3"
                                        Style="{StaticResource LabelStyle}"
                                        Text="轮询地址：" />
                                    <!--  替换横向StackPanel为Grid，实现TextBox自动占满剩余空间  -->
                                    <Grid Height="30">
                                        <!--  统一高度，和子控件保持一致  -->
                                        <!--  定义2列：第1列自动适配ComboBox，第2列占满剩余空间  -->
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <!--  第1列：自动适配ComboBox宽度，不浪费空间  -->
                                            <ColumnDefinition Width="*" />
                                            <!--  第2列：* 表示占满所有剩余横向空间，分配给TextBox  -->
                                        </Grid.ColumnDefinitions>

                                        <!--  ComboBox：放在第0列，保持原有样式，去掉Height（继承Grid的30高度）  -->
                                        <ComboBox
                                            x:Name="cboHttpMethod"
                                            Grid.Column="0"
                                            Width="60"
                                            Height="30"
                                            HorizontalContentAlignment="Center"
                                            VerticalContentAlignment="Center"
                                            pu:ComboBoxHelper.ClearButtonVisibility="Collapsed"
                                            pu:ComboBoxHelper.CornerRadius="4,0,0,4"
                                            pu:ComboBoxHelper.ItemsHoverBackground="#2236AAF7"
                                            pu:ComboBoxHelper.ItemsSelectedBackground="#36AAF7"
                                            pu:ComboBoxHelper.ItemsSelectedForeground="#FFFFFF"
                                            pu:ComboBoxHelper.OpenedBorderThickness="0"
                                            pu:ComboBoxHelper.OpenedCornerRadius="4,4,0,0"
                                            pu:ComboBoxHelper.OpenedForeground="#36AAF7"
                                            pu:ComboBoxHelper.OpenedShadowColor="#36AAF7"
                                            pu:ComboBoxHelper.WatermarkForeground="Gray"
                                            pu:DropDownHelper.BorderThickness="0"
                                            pu:DropDownHelper.CornerRadius="0,0,4,4"
                                            pu:DropDownHelper.ShadowColor="#36AAF7"
                                            pu:DropDownHelper.VerticalOffset="-1"
                                            pu:ShadowHelper.BlurRadius="15"
                                            pu:ShadowHelper.ShadowDepth="5"
                                            Background="Bisque"
                                            BorderThickness="1,1,0,1"
                                            FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=8}"
                                            FontWeight="Bold"
                                            SelectedIndex="0"
                                            SelectionChanged="CboHttpMethod_SelectionChanged">
                                            <pu:ComboBoxHelper.ToggleArrowTransformControlStyle>
                                                <Style BasedOn="{StaticResource {x:Static pu:ComboBoxHelper.ToggleArrowTransformControlStyleKey}}" TargetType="pu:TransformControl">
                                                    <!--<Setter Property="Visibility" Value="Collapsed" />-->
                                                    <Setter Property="FontSize" Value="8" />
                                                    <Setter Property="Background" Value="Transparent" />
                                                </Style>
                                            </pu:ComboBoxHelper.ToggleArrowTransformControlStyle>
                                            <ComboBoxItem Tag="GET">GET</ComboBoxItem>
                                            <ComboBoxItem Tag="POST">POST</ComboBoxItem>
                                        </ComboBox>

                                        <!--  TextBox：放在第1列，去掉Height，添加Grid.Column，实现自动占满剩余空间  -->
                                        <TextBox
                                            x:Name="txtEndpoint"
                                            Grid.Column="1"
                                            pu:IconHelper.FontFamily="{StaticResource PanuonIconFont}"
                                            pu:ShadowHelper.BlurRadius="15"
                                            pu:ShadowHelper.Opacity="0.5"
                                            pu:ShadowHelper.ShadowDepth="5"
                                            pu:TextBoxHelper.CornerRadius="0,4,4,0"
                                            pu:TextBoxHelper.FocusedBorderBrush="#36AAF7"
                                            pu:TextBoxHelper.FocusedForeground="#36AAF7"
                                            pu:TextBoxHelper.FocusedShadowColor="#36AAF7"
                                            pu:TextBoxHelper.Icon="&#xe9e9;"
                                            pu:TextBoxHelper.Watermark="输入接口地址"
                                            AcceptsReturn="True"
                                            BorderThickness="0,1,1,1"
                                            FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=9}"
                                            TextWrapping="Wrap"
                                            VerticalScrollBarVisibility="Auto" />

                                    </Grid>
                                </StackPanel>
                                <!--  频率  -->
                                <StackPanel Grid.Row="0" Grid.Column="2">
                                    <!--<TextBlock Style="{StaticResource LabelStyle}" Text="请求频率：间隔（秒）" />
                                    <pu:NumberInput
                                        x:Name="txtPollInterval"
                                        Height="30"
                                        HorizontalAlignment="Stretch"
                                        CornerRadius="5"
                                        FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=9}"
                                        Interval="1"
                                        Maximum="100"
                                        Minimum="1"
                                        Watermark="间隔（秒）" />-->
                                    <!--  新增：测试模式选择  -->
                                    <TextBlock
                                        x:Name="lblConfigDesc"
                                        Style="{StaticResource LabelStyle}"
                                        Text="请求频率：间隔（秒）" />
                                    <StackPanel Orientation="Horizontal">
                                        <ComboBox
                                            x:Name="cboTestMode"
                                            Height="30"
                                            VerticalAlignment="Center"
                                            pu:ComboBoxHelper.ClearButtonVisibility="Collapsed"
                                            pu:ComboBoxHelper.CornerRadius="4,0,0,4"
                                            pu:ComboBoxHelper.ItemsHoverBackground="#2236AAF7"
                                            pu:ComboBoxHelper.ItemsSelectedBackground="#36AAF7"
                                            pu:ComboBoxHelper.ItemsSelectedForeground="#FFFFFF"
                                            pu:ComboBoxHelper.OpenedBorderThickness="0"
                                            pu:ComboBoxHelper.OpenedCornerRadius="4,4,0,0"
                                            pu:ComboBoxHelper.OpenedForeground="#36AAF7"
                                            pu:ComboBoxHelper.OpenedShadowColor="#36AAF7"
                                            pu:ComboBoxHelper.Watermark="选择压测方式"
                                            pu:ComboBoxHelper.WatermarkForeground="Gray"
                                            pu:DropDownHelper.BorderThickness="0"
                                            pu:DropDownHelper.CornerRadius="0,0,4,4"
                                            pu:DropDownHelper.ShadowColor="#36AAF7"
                                            pu:DropDownHelper.VerticalOffset="-1"
                                            pu:ShadowHelper.BlurRadius="15"
                                            pu:ShadowHelper.ShadowDepth="5"
                                            BorderThickness="1,1,0,1"
                                            FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=9}"
                                            SelectedIndex="0">
                                            <ComboBoxItem Tag="HighFrequency">高频压测（一秒几次）</ComboBoxItem>
                                            <ComboBoxItem Tag="StableMonitor">稳定监控（几秒几次）</ComboBoxItem>
                                        </ComboBox>

                                        <pu:NumberInput
                                            x:Name="txtPollInterval"
                                            Height="30"
                                            HorizontalAlignment="Stretch"
                                            BorderThickness="0,1,1,1"
                                            CornerRadius="0,4,4,0"
                                            FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=9}"
                                            Interval="1"
                                            Maximum="100"
                                            Minimum="1" />
                                    </StackPanel>

                                </StackPanel>

                                <!--  机器数  -->
                                <StackPanel Grid.Row="0" Grid.Column="4">
                                    <TextBlock Style="{StaticResource LabelStyle}" Text="机器数量：" />
                                    <pu:NumberInput
                                        x:Name="txtMachineCount"
                                        Height="30"
                                        HorizontalAlignment="Stretch"
                                        CornerRadius="5"
                                        FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=9}"
                                        Interval="1"
                                        Maximum="100"
                                        Minimum="1"
                                        ValueChanged="txtMachineCount_ValueChanged"
                                        Watermark="机器数量" />
                                </StackPanel>

                                <StackPanel
                                    Grid.Row="0"
                                    Grid.Column="6"
                                    Margin="20,10,0,0"
                                    Orientation="Horizontal">
                                    <Button
                                        x:Name="btnSave"
                                        Width="30"
                                        Height="30"
                                        Margin="0,2,20,0"
                                        HorizontalAlignment="Right"
                                        VerticalAlignment="Top"
                                        Panel.ZIndex="111"
                                        pu:ButtonHelper.CornerRadius="40,40,40,40"
                                        pu:ButtonHelper.ShadowColor="#36AAF7"
                                        pu:ShadowHelper.BlurRadius="15"
                                        pu:ShadowHelper.ShadowDepth="3"
                                        Background="#36AAF7"
                                        Click="btnSave_Click"
                                        Content="&#xe9e1;"
                                        FontFamily="{StaticResource PanuonIconFont}"
                                        FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=13}"
                                        Foreground="#FFFFFF" />
                                    <Button
                                        x:Name="btnClean"
                                        Width="30"
                                        Height="30"
                                        Margin="0,2,20,0"
                                        HorizontalAlignment="Right"
                                        VerticalAlignment="Top"
                                        Panel.ZIndex="111"
                                        pu:ButtonHelper.CornerRadius="40,40,40,40"
                                        pu:ButtonHelper.ShadowColor="#E74C3C"
                                        pu:ShadowHelper.BlurRadius="15"
                                        pu:ShadowHelper.ShadowDepth="3"
                                        Background="{StaticResource DangerColor}"
                                        Click="btnClean_Click"
                                        Content="&#xe92d;"
                                        FontFamily="{StaticResource PanuonIconFont}"
                                        FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=13}"
                                        Foreground="#FFFFFF" />
                                </StackPanel>
                                <!--  请求方法  -->
                                <!--
                                <StackPanel Grid.Row="0" Grid.Column="6">
                                    <TextBlock Style="{StaticResource LabelStyle}" Text="请求方法：" />
                                    <StackPanel
                                        Height="30"
                                        HorizontalAlignment="Stretch"
                                        Orientation="Horizontal">
                                -->
                                <!--  均匀分布按钮  -->
                                <!--
                                        <RadioButton
                                            x:Name="rbGet"
                                            VerticalAlignment="Center"
                                            HorizontalContentAlignment="Center"
                                            pu:RadioButtonHelper.BoxRadius="10"
                                            pu:RadioButtonHelper.CheckedBorderBrush="#d1d6d8"
                                            pu:RadioButtonHelper.CheckedBorderThickness="8"
                                            Background="#FFFFFFFF"
                                            BorderBrush="#FFABB7CB"
                                            BorderThickness="2"
                                            FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=9}"
                                            GroupName="HttpMethod">
                                            GET
                                            <pu:RadioButtonHelper.CheckedToggleBrush>
                                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                                    <GradientStop Offset="0.0" Color="#FFFD790D" />
                                                    <GradientStop Offset="1.0" Color="#FFFFFFFF" />
                                                </LinearGradientBrush>
                                            </pu:RadioButtonHelper.CheckedToggleBrush>
                                            <pu:RadioButtonHelper.ToggleBrush>
                                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                                    <GradientStop Offset="0.0" Color="#FFE1E1E1" />
                                                    <GradientStop Offset="1.0" Color="#FFFFFFFF" />
                                                </LinearGradientBrush>
                                            </pu:RadioButtonHelper.ToggleBrush>
                                        </RadioButton>
                                        <RadioButton
                                            x:Name="rbPost"
                                            VerticalAlignment="Center"
                                            HorizontalContentAlignment="Center"
                                            pu:RadioButtonHelper.BoxRadius="10"
                                            pu:RadioButtonHelper.CheckedBorderBrush="#d1d6d8"
                                            pu:RadioButtonHelper.CheckedBorderThickness="8"
                                            Background="#FFFFFFFF"
                                            BorderBrush="#FFABB7CB"
                                            BorderThickness="2"
                                            FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=9}"
                                            GroupName="HttpMethod">
                                            POST
                                            <pu:RadioButtonHelper.CheckedToggleBrush>
                                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                                    <GradientStop Offset="0.0" Color="#FFFD790D" />
                                                    <GradientStop Offset="1.0" Color="#FFFFFFFF" />
                                                </LinearGradientBrush>
                                            </pu:RadioButtonHelper.CheckedToggleBrush>
                                            <pu:RadioButtonHelper.ToggleBrush>
                                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                                    <GradientStop Offset="0.0" Color="#FFE1E1E1" />
                                                    <GradientStop Offset="1.0" Color="#FFFFFFFF" />
                                                </LinearGradientBrush>
                                            </pu:RadioButtonHelper.ToggleBrush>
                                        </RadioButton>
                                    </StackPanel>
                                </StackPanel>-->
                                <StackPanel
                                    Grid.Row="1"
                                    Grid.ColumnSpan="7"
                                    Margin="0,5,0,0">
                                    <TextBlock Style="{StaticResource LabelStyle}" Text="JSON 参数：" />
                                    <TextBox
                                        x:Name="txtParametersJson"
                                        MinHeight="120"
                                        pu:IconHelper.FontFamily="{StaticResource PanuonIconFont}"
                                        pu:ShadowHelper.BlurRadius="15"
                                        pu:ShadowHelper.Opacity="0.5"
                                        pu:ShadowHelper.ShadowDepth="5"
                                        pu:TextBoxHelper.CornerRadius="4"
                                        pu:TextBoxHelper.FocusedBorderBrush="#36AAF7"
                                        pu:TextBoxHelper.FocusedForeground="#36AAF7"
                                        pu:TextBoxHelper.FocusedShadowColor="#36AAF7"
                                        pu:TextBoxHelper.Icon="&#xe9e9;"
                                        pu:TextBoxHelper.Watermark="请求参数（JSON格式，POST请求专用）"
                                        AcceptsReturn="True"
                                        FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=9}"
                                        TextWrapping="Wrap"
                                        VerticalScrollBarVisibility="Auto" />
                                </StackPanel>
                            </Grid>
                        </StackPanel>
                    </Grid>
                </GroupBox>

                <GroupBox
                    Grid.Column="2"
                    pu:GroupBoxHelper.CornerRadius="9"
                    pu:GroupBoxHelper.HeaderBackground="#FFD0DDEE"
                    pu:GroupBoxHelper.HeaderBorderBrush="#00FFFFFF"
                    pu:GroupBoxHelper.HeaderCornerRadius="8,8,0,0"
                    pu:GroupBoxHelper.HeaderFontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=11}"
                    pu:GroupBoxHelper.HeaderHeight="35"
                    pu:GroupBoxHelper.HeaderHorizontalContentAlignment="Left"
                    pu:GroupBoxHelper.HeaderPadding="7,0,0,0"
                    BorderBrush="#FFD0DDEE"
                    Header="历史记录">
                    <Grid Grid.Row="0" Background="White">
                        <!--  外层Grid：仅包含按钮和ListBox，取消多余嵌套  -->
                        <Grid Margin="0">
                            <!--  刷新按钮：固定右上角，Margin控制与边缘距离  -->
                            <Button
                                x:Name="btnLoadFromHistory"
                                Width="25"
                                Height="25"
                                Margin="0,2,10,0"
                                HorizontalAlignment="Right"
                                VerticalAlignment="Top"
                                Panel.ZIndex="111"
                                pu:ButtonHelper.CornerRadius="40,40,40,40"
                                pu:ButtonHelper.ShadowColor="#6CCF70"
                                pu:ShadowHelper.BlurRadius="15"
                                pu:ShadowHelper.ShadowDepth="3"
                                Background="#6CCF70"
                                Click="LoadFromHistory_Click"
                                Content="&#xe970;"
                                FontFamily="{StaticResource PanuonIconFont}"
                                FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=10}"
                                Foreground="#FFFFFF" />
                            <Button
                                x:Name="btnDeleteSelectedHistory"
                                Width="25"
                                Height="25"
                                Margin="0,35,10,0"
                                HorizontalAlignment="Right"
                                VerticalAlignment="Top"
                                Panel.ZIndex="111"
                                pu:ButtonHelper.CornerRadius="40,40,40,40"
                                pu:ButtonHelper.ShadowColor="#E74C3C"
                                pu:ShadowHelper.BlurRadius="15"
                                pu:ShadowHelper.ShadowDepth="3"
                                Background="{StaticResource DangerColor}"
                                Click="BtnDeleteSelectedHistory_Click"
                                Content="&#xe92d;"
                                FontFamily="{StaticResource PanuonIconFont}"
                                FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=10}"
                                Foreground="#FFFFFF">
                                <Button.ToolTip>
                                    <TextBlock Text="删除当前选中的历史记录" />
                                </Button.ToolTip>
                            </Button>
                            <Button
                                x:Name="btnEditSelectedHistory"
                                Width="25"
                                Height="25"
                                Margin="0,70,10,0"
                                HorizontalAlignment="Right"
                                VerticalAlignment="Top"
                                Panel.ZIndex="111"
                                pu:ButtonHelper.CornerRadius="40,40,40,40"
                                pu:ButtonHelper.ShadowColor="#6CCF70"
                                pu:ShadowHelper.BlurRadius="15"
                                pu:ShadowHelper.ShadowDepth="3"
                                Background="#36AAF7"
                                Click="BtnEditSelectedHistory_Click"
                                Content="&#xe9b3;"
                                FontFamily="{StaticResource PanuonIconFont}"
                                FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=10}"
                                Foreground="#FFFFFF">
                                <Button.ToolTip>
                                    <TextBlock Text="编辑当前选中的历史记录" />
                                </Button.ToolTip>
                            </Button>
                            <!--  新增：Popup 编辑面板（默认隐藏，无新窗体，内嵌当前窗口）  -->
                            <Popup
                                x:Name="editHistoryPopup"
                                Width="400"
                                Height="500"
                                AllowsTransparency="True"
                                MouseLeftButtonDown="EditHistoryPopup_MouseLeftButtonDown"
                                Placement="Center"
                                PlacementTarget="{Binding RelativeSource={RelativeSource AncestorType=Window}}"
                                PopupAnimation="Fade"
                                StaysOpen="False">
                                <!--  给 Border 添加原生 DropShadowEffect 阴影，去除 pu 相关阴影属性  -->
                                <Border
                                    Margin="20"
                                    Padding="20"
                                    Background="White"
                                    BorderBrush="#E0E0E0"
                                    BorderThickness="0"
                                    CornerRadius="8"
                                    MouseLeftButtonDown="EditHistoryPopup_MouseLeftButtonDown">
                                    <!--  原生阴影效果：添加在 Border 的 Effect 属性中，可自定义所有参数  -->
                                    <Border.Effect>
                                        <DropShadowEffect
                                            BlurRadius="20"
                                            Direction="225"
                                            Opacity="0.8"
                                            ShadowDepth="8"
                                            Color="#33000000" />
                                    </Border.Effect>
                                    <Grid>
                                        <!--  原有布局不变，保留所有输入框/按钮  -->
                                        <StackPanel>
                                            <TextBlock
                                                Margin="0,10,0,3"
                                                Style="{StaticResource LabelStyle}"
                                                Text="自定义名称：" />
                                            <TextBox
                                                x:Name="txtPopupCustomName"
                                                Grid.Column="1"
                                                Height="30"
                                                pu:IconHelper.FontFamily="{StaticResource PanuonIconFont}"
                                                pu:ShadowHelper.BlurRadius="15"
                                                pu:ShadowHelper.Opacity="0.5"
                                                pu:ShadowHelper.ShadowDepth="5"
                                                pu:TextBoxHelper.CornerRadius="4"
                                                pu:TextBoxHelper.FocusedBorderBrush="#36AAF7"
                                                pu:TextBoxHelper.FocusedForeground="#36AAF7"
                                                pu:TextBoxHelper.FocusedShadowColor="#36AAF7"
                                                pu:TextBoxHelper.Icon="&#xe9e9;"
                                                pu:TextBoxHelper.Watermark="输入自定义名称"
                                                AcceptsReturn="True"
                                                BorderThickness="1"
                                                FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=9}"
                                                TextWrapping="Wrap"
                                                VerticalScrollBarVisibility="Auto" />
                                            <TextBlock
                                                Margin="0,10,0,3"
                                                Style="{StaticResource LabelStyle}"
                                                Text="接口地址：" />
                                            <TextBox
                                                x:Name="txtPopupEndpoint"
                                                Grid.Column="1"
                                                Height="60"
                                                pu:IconHelper.FontFamily="{StaticResource PanuonIconFont}"
                                                pu:ShadowHelper.BlurRadius="15"
                                                pu:ShadowHelper.Opacity="0.5"
                                                pu:ShadowHelper.ShadowDepth="5"
                                                pu:TextBoxHelper.CornerRadius="4"
                                                pu:TextBoxHelper.FocusedBorderBrush="#36AAF7"
                                                pu:TextBoxHelper.FocusedForeground="#36AAF7"
                                                pu:TextBoxHelper.FocusedShadowColor="#36AAF7"
                                                pu:TextBoxHelper.Icon="&#xe9e9;"
                                                pu:TextBoxHelper.Watermark="输入接口地址"
                                                AcceptsReturn="True"
                                                BorderThickness="1"
                                                FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=9}"
                                                TextWrapping="Wrap"
                                                VerticalScrollBarVisibility="Auto" />
                                            <StackPanel Margin="0,10,0,0" Orientation="Horizontal">
                                                <StackPanel>
                                                    <TextBlock Style="{StaticResource LabelStyle}" Text="机器数量：" />
                                                    <pu:NumberInput
                                                        x:Name="txtPopupMachineCount"
                                                        Width="100"
                                                        Height="30"
                                                        HorizontalAlignment="Stretch"
                                                        CornerRadius="5"
                                                        FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=9}"
                                                        Interval="1"
                                                        Maximum="100"
                                                        Minimum="1"
                                                        Watermark="机器数量" />
                                                </StackPanel>
                                                <StackPanel Margin="10,0,0,0">
                                                    <TextBlock Style="{StaticResource LabelStyle}" Text="频率设置：" />
                                                    <StackPanel Orientation="Horizontal">
                                                        <ComboBox
                                                            x:Name="cboPopuTestMode"
                                                            Height="30"
                                                            VerticalAlignment="Center"
                                                            pu:ComboBoxHelper.ClearButtonVisibility="Collapsed"
                                                            pu:ComboBoxHelper.CornerRadius="4,0,0,4"
                                                            pu:ComboBoxHelper.ItemsHoverBackground="#2236AAF7"
                                                            pu:ComboBoxHelper.ItemsSelectedBackground="#36AAF7"
                                                            pu:ComboBoxHelper.ItemsSelectedForeground="#FFFFFF"
                                                            pu:ComboBoxHelper.OpenedBorderThickness="0"
                                                            pu:ComboBoxHelper.OpenedCornerRadius="4,4,0,0"
                                                            pu:ComboBoxHelper.OpenedForeground="#36AAF7"
                                                            pu:ComboBoxHelper.OpenedShadowColor="#36AAF7"
                                                            pu:ComboBoxHelper.Watermark="Select an option"
                                                            pu:ComboBoxHelper.WatermarkForeground="Gray"
                                                            pu:DropDownHelper.BorderThickness="0"
                                                            pu:DropDownHelper.CornerRadius="0,0,4,4"
                                                            pu:DropDownHelper.ShadowColor="#36AAF7"
                                                            pu:DropDownHelper.VerticalOffset="-1"
                                                            pu:ShadowHelper.BlurRadius="15"
                                                            pu:ShadowHelper.ShadowDepth="5"
                                                            BorderThickness="1,1,0,1"
                                                            FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=9}"
                                                            SelectedIndex="0">
                                                            <ComboBoxItem Tag="HighFrequency">高频压测（一秒几次）</ComboBoxItem>
                                                            <ComboBoxItem Tag="StableMonitor">稳定监控（几秒几次）</ComboBoxItem>
                                                        </ComboBox>
                                                        <pu:NumberInput
                                                            x:Name="txtPopuPollInterval"
                                                            Width="50"
                                                            Height="30"
                                                            HorizontalAlignment="Stretch"
                                                            BorderThickness="0,1,1,1"
                                                            CornerRadius="0,4,4,0"
                                                            FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=9}"
                                                            Interval="1"
                                                            Maximum="100"
                                                            Minimum="1" />
                                                    </StackPanel>
                                                </StackPanel>
                                            </StackPanel>
                                            <StackPanel Margin="0,10,0,0">
                                                <TextBlock Style="{StaticResource LabelStyle}" Text="JSON 参数：" />
                                                <TextBox
                                                    x:Name="txtPopuParametersJson"
                                                    MinHeight="120"
                                                    pu:IconHelper.FontFamily="{StaticResource PanuonIconFont}"
                                                    pu:ShadowHelper.BlurRadius="15"
                                                    pu:ShadowHelper.Opacity="0.5"
                                                    pu:ShadowHelper.ShadowDepth="5"
                                                    pu:TextBoxHelper.CornerRadius="4"
                                                    pu:TextBoxHelper.FocusedBorderBrush="#36AAF7"
                                                    pu:TextBoxHelper.FocusedForeground="#36AAF7"
                                                    pu:TextBoxHelper.FocusedShadowColor="#36AAF7"
                                                    pu:TextBoxHelper.Icon="&#xe9e9;"
                                                    pu:TextBoxHelper.Watermark="请求参数（JSON格式，POST请求专用）"
                                                    AcceptsReturn="True"
                                                    FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=9}"
                                                    TextWrapping="Wrap"
                                                    VerticalScrollBarVisibility="Auto" />
                                            </StackPanel>
                                            <StackPanel
                                                Grid.Row="2"
                                                Grid.Column="0"
                                                Grid.ColumnSpan="2"
                                                Margin="0,20,0,0"
                                                HorizontalAlignment="Center"
                                                Orientation="Horizontal">

                                                <Button
                                                    x:Name="btnPopupConfirm"
                                                    Height="30"
                                                    MinWidth="100"
                                                    MaxWidth="140"
                                                    Margin="0,0,10,0"
                                                    pu:ButtonHelper.CornerRadius="4"
                                                    pu:ButtonHelper.Icon="&#xe93d;"
                                                    pu:ButtonHelper.ShadowColor="#2ECC71"
                                                    pu:IconHelper.FontFamily="{StaticResource PanuonIconFont}"
                                                    pu:IconHelper.FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=11}"
                                                    pu:IconHelper.Margin="0,0,5,0"
                                                    pu:ShadowHelper.BlurRadius="15"
                                                    pu:ShadowHelper.ShadowDepth="5"
                                                    Background="{StaticResource SuccessColor}"
                                                    Click="BtnPopupConfirm_Click"
                                                    Content="确定"
                                                    FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=11}"
                                                    Foreground="#FFFFFF" />
                                                <Button
                                                    x:Name="btnPopupCancel"
                                                    Height="30"
                                                    MinWidth="100"
                                                    MaxWidth="140"
                                                    Margin="0,0,10,0"
                                                    pu:ButtonHelper.CornerRadius="4"
                                                    pu:ButtonHelper.Icon="&#xe933;"
                                                    pu:ButtonHelper.ShadowColor="#E74C3C"
                                                    pu:IconHelper.FontFamily="{StaticResource PanuonIconFont}"
                                                    pu:IconHelper.FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=11}"
                                                    pu:IconHelper.Margin="0,0,5,0"
                                                    pu:ShadowHelper.BlurRadius="15"
                                                    pu:ShadowHelper.ShadowDepth="5"
                                                    Background="{StaticResource DangerColor}"
                                                    Click="BtnPopupCancel_Click"
                                                    Content="取消"
                                                    FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=11}"
                                                    Foreground="#ffffff" />

                                            </StackPanel>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                            </Popup>
                            <!--  ListBox：核心占满设置，取消外层Height限制，让其随父容器拉伸  -->
                            <ListBox
                                x:Name="lbHistory"
                                MaxHeight="190"
                                Margin="0"
                                Padding="0"
                                HorizontalAlignment="Stretch"
                                VerticalAlignment="Stretch"
                                HorizontalContentAlignment="Stretch"
                                VerticalContentAlignment="Stretch"
                                pu:ListBoxHelper.CornerRadius="4"
                                pu:ScrollBarHelper.HoverThumbBackground="#E0E0E0"
                                pu:ScrollBarHelper.ThumbBackground="#ffb7c5"
                                pu:ScrollViewerHelper.ContentSpacing="5"
                                pu:ScrollViewerHelper.ScrollBarPosition="Outside"
                                pu:ScrollViewerHelper.ScrollBarThickness="5"
                                Background="Transparent"
                                BorderBrush="#DDDDDD"
                                BorderThickness="0"
                                SelectionChanged="LbHistory_SelectionChanged">

                                <!--  列表项模板：保持原有  -->
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <Grid Height="28">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="80" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>
                                            <TextBlock
                                                Grid.Column="0"
                                                Margin="10,0,0,0"
                                                VerticalAlignment="Center"
                                                FontSize="11"
                                                FontWeight="Bold"
                                                Foreground="{StaticResource SecondaryColor}"
                                                Text="{Binding SavedTime, StringFormat=\{0:MM-dd HH:mm\}}" />
                                            <TextBlock
                                                Grid.Column="1"
                                                Margin="5,0,0,0"
                                                VerticalAlignment="Center"
                                                FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=9}"
                                                Foreground="{StaticResource TextPrimaryColor}"
                                                Text="{Binding Endpoint}"
                                                TextTrimming="CharacterEllipsis" />
                                        </Grid>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>

                                <!--  虚拟化面板：保持原有  -->
                                <ListBox.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <VirtualizingStackPanel Margin="0" />
                                    </ItemsPanelTemplate>
                                </ListBox.ItemsPanel>

                                <!--  核心修复：ItemContainerStyle + 重写 ControlTemplate（强制生效）  -->
                                <ListBox.ItemContainerStyle>
                                    <!--  1. BasedOn 继承 Panuon 的默认 ListBoxItem 样式，确保 Helper 生效  -->
                                    <Style BasedOn="{StaticResource {x:Type ListBoxItem}}" TargetType="ListBoxItem">
                                        <!--  基础布局：取消边距  -->
                                        <Setter Property="Margin" Value="0" />
                                        <Setter Property="Padding" Value="0" />
                                        <Setter Property="HorizontalAlignment" Value="Stretch" />
                                        <Setter Property="VerticalAlignment" Value="Center" />

                                        <!--  2. 强制设置 Panuon Helper 属性（优先级最高）  -->
                                        <Setter Property="pu:ListBoxHelper.ItemsBackground" Value="Transparent" />
                                        <Setter Property="pu:ListBoxHelper.ItemsHoverBackground" Value="#F8E5E5" />
                                        <Setter Property="pu:ListBoxHelper.ItemsHoverBorderBrush" Value="#6CCF70" />
                                        <Setter Property="pu:ListBoxHelper.ItemsHoverBorderThickness" Value="0" />
                                        <Setter Property="pu:ListBoxHelper.ItemsHoverCornerRadius" Value="4" />
                                        <Setter Property="pu:ListBoxHelper.ItemsSelectedBackground" Value="#F8E5E5" />
                                        <Setter Property="pu:ListBoxHelper.ItemsSelectedBorderBrush" Value="Transparent" />
                                        <Setter Property="pu:ListBoxHelper.ItemsSelectedBorderThickness" Value="0" />
                                        <Setter Property="pu:ListBoxHelper.ItemsSelectedCornerRadius" Value="4" />

                                        <!--  3. 重写 ControlTemplate（彻底摆脱默认样式干扰，核心！）  -->
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="ListBoxItem">
                                                    <Grid
                                                        x:Name="RootGrid"
                                                        Background="{TemplateBinding Background}"
                                                        SnapsToDevicePixels="True">
                                                        <!--  绑定 Panuon Helper 的背景/边框/圆角  -->
                                                        <Border
                                                            x:Name="ItemBorder"
                                                            Background="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=(pu:ListBoxHelper.ItemsBackground)}"
                                                            BorderBrush="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=(pu:ListBoxHelper.ItemsBorderBrush)}"
                                                            BorderThickness="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=(pu:ListBoxHelper.ItemsBorderThickness)}"
                                                            CornerRadius="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=(pu:ListBoxHelper.ItemsCornerRadius)}"
                                                            SnapsToDevicePixels="True">
                                                            <!--  内容容器：显示 ItemTemplate  -->
                                                            <ContentPresenter
                                                                Margin="{TemplateBinding Padding}"
                                                                HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                                                VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                                                Focusable="False"
                                                                SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" />
                                                        </Border>
                                                    </Grid>

                                                    <!--  4. 触发器：手动实现 Hover/Selected 状态（不依赖 Panuon 自动触发）  -->
                                                    <ControlTemplate.Triggers>
                                                        <!--  悬浮状态  -->
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter TargetName="ItemBorder" Property="Background" Value="#ffb7c5" />
                                                            <Setter TargetName="ItemBorder" Property="BorderBrush" Value="#6CCF70" />
                                                            <Setter TargetName="ItemBorder" Property="BorderThickness" Value="0" />
                                                            <Setter TargetName="ItemBorder" Property="CornerRadius" Value="4" />
                                                        </Trigger>

                                                        <!--  选中状态  -->
                                                        <Trigger Property="IsSelected" Value="True">
                                                            <Setter TargetName="ItemBorder" Property="Background" Value="#F8E5E5" />
                                                            <Setter TargetName="ItemBorder" Property="BorderBrush" Value="Transparent" />
                                                            <Setter TargetName="ItemBorder" Property="BorderThickness" Value="0" />
                                                            <Setter TargetName="ItemBorder" Property="CornerRadius" Value="4" />
                                                        </Trigger>

                                                        <!--  禁用状态（可选）  -->
                                                        <Trigger Property="IsEnabled" Value="False">
                                                            <Setter TargetName="ItemBorder" Property="Opacity" Value="0.5" />
                                                        </Trigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </ListBox.ItemContainerStyle>
                            </ListBox>
                        </Grid>
                    </Grid>
                </GroupBox>
            </Grid>

            <!--  第二行：功能按钮区域（保留不变）  -->
            <pu:Card
                Grid.Row="2"
                Height="55"
                Margin="0,15,0,15"
                pu:ShadowHelper.BlurRadius="15"
                pu:ShadowHelper.Direction="270"
                pu:ShadowHelper.Opacity="0.3"
                pu:ShadowHelper.ShadowDepth="15"
                Background="#F8E5E5"
                BorderThickness="0"
                ClickBackground="#F8E5E5"
                CornerRadius="10"
                HoverBackground="#F8E5E5"
                ShadowColor="#2a66c1">
                <StackPanel
                    Grid.Row="1"
                    HorizontalAlignment="Right"
                    Orientation="Horizontal">

                    <Button
                        x:Name="btnStartPolling"
                        Height="30"
                        MinWidth="100"
                        MaxWidth="140"
                        Margin="0,0,10,0"
                        pu:ButtonHelper.CornerRadius="4"
                        pu:ButtonHelper.Icon="&#xe93d;"
                        pu:ButtonHelper.ShadowColor="#2ECC71"
                        pu:IconHelper.FontFamily="{StaticResource PanuonIconFont}"
                        pu:IconHelper.FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=11}"
                        pu:IconHelper.Margin="0,0,5,0"
                        pu:ShadowHelper.BlurRadius="15"
                        pu:ShadowHelper.ShadowDepth="5"
                        Background="{StaticResource SuccessColor}"
                        Click="StartPolling_Click"
                        Content="开始轮询"
                        FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=11}"
                        Foreground="#FFFFFF" />
                    <Button
                        x:Name="btnStopPolling"
                        Height="30"
                        MinWidth="100"
                        MaxWidth="140"
                        Margin="0,0,10,0"
                        pu:ButtonHelper.CornerRadius="4"
                        pu:ButtonHelper.Icon="&#xe933;"
                        pu:ButtonHelper.ShadowColor="#E74C3C"
                        pu:IconHelper.FontFamily="{StaticResource PanuonIconFont}"
                        pu:IconHelper.FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=11}"
                        pu:IconHelper.Margin="0,0,5,0"
                        pu:ShadowHelper.BlurRadius="15"
                        pu:ShadowHelper.ShadowDepth="5"
                        Background="{StaticResource DangerColor}"
                        Click="StopPolling_Click"
                        Content="停止轮询"
                        FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=11}"
                        Foreground="#ffffff" />
                    <Button
                        x:Name="btnClearLogs"
                        Height="30"
                        MinWidth="100"
                        MaxWidth="140"
                        Margin="0,0,10,0"
                        pu:ButtonHelper.CornerRadius="4"
                        pu:ButtonHelper.Icon="&#xe9df;"
                        pu:ButtonHelper.ShadowColor="#F39C12"
                        pu:IconHelper.FontFamily="{StaticResource PanuonIconFont}"
                        pu:IconHelper.FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=11}"
                        pu:IconHelper.Margin="0,0,5,0"
                        pu:ShadowHelper.BlurRadius="15"
                        pu:ShadowHelper.ShadowDepth="5"
                        Background="{StaticResource WarningColor}"
                        Click="ClearLogs_Click"
                        Content="清空日志"
                        FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=11}"
                        Foreground="#ffffff" />
                </StackPanel>
            </pu:Card>
            <!--<GroupBox
                Grid.Row="1"
                Margin="0,5,0,0"
                pu:GroupBoxHelper.CornerRadius="9"
                pu:GroupBoxHelper.HeaderBackground="Transparent"
                pu:GroupBoxHelper.HeaderBorderBrush="Transparent"
                pu:GroupBoxHelper.HeaderBorderThickness="0"
                pu:GroupBoxHelper.HeaderCornerRadius="8,8,0,0"
                pu:GroupBoxHelper.HeaderFontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=11}"
                pu:GroupBoxHelper.HeaderHeight="35"
                pu:GroupBoxHelper.HeaderHorizontalContentAlignment="Left"
                pu:GroupBoxHelper.HeaderPadding="7,0,0,0"
                BorderBrush="#FFD0DDEE"
                Header="功能操作">

            </GroupBox>-->
            <GroupBox
                Grid.Row="1"
                Margin="0,5,0,0"
                pu:GroupBoxHelper.CornerRadius="9"
                pu:GroupBoxHelper.HeaderBackground="#FFD0DDEE"
                pu:GroupBoxHelper.HeaderBorderBrush="#00FFFFFF"
                pu:GroupBoxHelper.HeaderCornerRadius="8,8,0,0"
                pu:GroupBoxHelper.HeaderFontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=11}"
                pu:GroupBoxHelper.HeaderHeight="35"
                pu:GroupBoxHelper.HeaderHorizontalContentAlignment="Left"
                pu:GroupBoxHelper.HeaderPadding="7,0,0,0"
                BorderBrush="#FFD0DDEE"
                Header="全局输出">
                <Grid>
                    <Grid.RowDefinitions>
                        <!--  机器过滤按钮行（新增）  -->
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <!--  统计面板行（新增）  -->
                        <RowDefinition Height="*" />
                        <!--  全局日志ListBox行  -->
                    </Grid.RowDefinitions>
                    <!--  第三行：机器过滤按钮容器（新增 - 横向滚动）  -->
                    <ScrollViewer
                        Grid.Row="0"
                        Height="35"
                        pu:ScrollBarHelper.HoverThumbBackground="#E0E0E0"
                        pu:ScrollBarHelper.ThumbBackground="#ffb7c5"
                        pu:ScrollViewerHelper.ContentSpacing="5"
                        pu:ScrollViewerHelper.ScrollBarPosition="Outside"
                        pu:ScrollViewerHelper.ScrollBarThickness="5"
                        HorizontalScrollBarVisibility="Auto"
                        VerticalScrollBarVisibility="Disabled">
                        <StackPanel
                            x:Name="spMachineFilterButtons"
                            Margin="3,0,0,0"
                            Orientation="Horizontal">
                            <!--  固定按钮：全部日志  -->
                            <Button
                                x:Name="btnAllLogs"
                                Click="BtnAllLogs_Click"
                                Content="全部日志"
                                Style="{StaticResource MachineFilterButtonStyle}" />
                            <!--  固定按钮：硬件监控（专属点击事件）  -->
                            <Button
                                x:Name="btnHardwareLogs"
                                Click="BtnHardwareLogs_Click"
                                Content="硬件监控"
                                Style="{StaticResource MachineFilterButtonStyle}" />
                            <!--  固定按钮：系统日志（新增，专属点击事件）  -->
                            <Button
                                x:Name="btnSystemLogs"
                                Click="BtnSystemLogs_Click"
                                Content="系统日志"
                                Style="{StaticResource MachineFilterButtonStyle}" />
                            <Button
                                x:Name="btnPortLogs"
                                Click="btnPortLogs_Click"
                                Content="端口占用"
                                Style="{StaticResource MachineFilterButtonStyle}" />
                            <Button
                                x:Name="btnErrorLogs"
                                Click="BtnErrorLogs_Click"
                                Content="异常日志"
                                Style="{StaticResource MachineFilterButtonStyle}" />
                            <!--<Button
                                x:Name="btnAllLogs"
                                Height="20"
                                MinWidth="65"
                                MaxWidth="140"
                                Margin="0,0,10,0"
                                pu:ButtonHelper.CornerRadius="1"
                                pu:ButtonHelper.Icon="&#xe93d;"
                                pu:ButtonHelper.ShadowColor="#2ECC71"
                                pu:IconHelper.FontFamily="{StaticResource PanuonIconFont}"
                                pu:IconHelper.FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=9}"
                                pu:IconHelper.Margin="0,0,5,0"
                                pu:ShadowHelper.BlurRadius="10"
                                pu:ShadowHelper.ShadowDepth="3"
                                Background="{StaticResource PrimaryColor}"
                                Click="BtnAllLogs_Click"
                                Content="全部日志"
                                FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=9}" />-->
                        </StackPanel>
                    </ScrollViewer>

                    <!--  第四行：实时统计面板（新增 - 全局唯一）  -->
                    <Border
                        Grid.Row="1"
                        Margin="0,10,0,0"
                        Padding="10"
                        Background="White"
                        BorderBrush="{StaticResource SecondaryColor}"
                        BorderThickness="1"
                        CornerRadius="6">
                        <Grid>
                            <!--  优化列定义：7列均分，每列最小宽度120防止挤压  -->
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" MinWidth="120" />
                                <ColumnDefinition Width="*" MinWidth="120" />
                                <ColumnDefinition Width="*" MinWidth="120" />
                                <ColumnDefinition Width="*" MinWidth="120" />
                                <ColumnDefinition Width="*" MinWidth="120" />
                                <ColumnDefinition Width="*" MinWidth="120" />
                                <ColumnDefinition Width="*" MinWidth="120" />
                            </Grid.ColumnDefinitions>

                            <!--  总请求数（原有，无修改）  -->
                            <StackPanel
                                Grid.Column="0"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center">
                                <TextBlock
                                    HorizontalAlignment="Center"
                                    FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=11}"
                                    Foreground="{StaticResource TextSecondaryColor}"
                                    Text="总请求数" />
                                <TextBlock
                                    x:Name="txtTotalRequests"
                                    HorizontalAlignment="Center"
                                    FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=20}"
                                    FontWeight="Bold"
                                    Foreground="{StaticResource PrimaryColor}"
                                    Text="0" />
                            </StackPanel>

                            <!--  成功请求数（原有，无修改）  -->
                            <StackPanel
                                Grid.Column="1"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center">
                                <TextBlock
                                    HorizontalAlignment="Center"
                                    FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=11}"
                                    Foreground="{StaticResource TextSecondaryColor}"
                                    Text="成功请求数" />
                                <TextBlock
                                    x:Name="txtSuccessRequests"
                                    HorizontalAlignment="Center"
                                    FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=20}"
                                    FontWeight="Bold"
                                    Foreground="{StaticResource SuccessColor}"
                                    Text="0" />
                            </StackPanel>

                            <!--  成功率（原有，无修改）  -->
                            <StackPanel
                                Grid.Column="2"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center">
                                <TextBlock
                                    HorizontalAlignment="Center"
                                    FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=11}"
                                    Foreground="{StaticResource TextSecondaryColor}"
                                    Text="成功率" />
                                <TextBlock
                                    x:Name="txtSuccessRate"
                                    HorizontalAlignment="Center"
                                    FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=20}"
                                    FontWeight="Bold"
                                    Foreground="{StaticResource SecondaryColor}"
                                    Text="0.00%" />
                            </StackPanel>

                            <!--  端口占用数（原有，无修改）  -->
                            <StackPanel
                                Grid.Column="3"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center">
                                <TextBlock
                                    HorizontalAlignment="Center"
                                    FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=11}"
                                    Foreground="{StaticResource TextSecondaryColor}"
                                    Text="端口占用数" />
                                <TextBlock
                                    x:Name="txtPortUsage"
                                    HorizontalAlignment="Center"
                                    FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=20}"
                                    FontWeight="Bold"
                                    Foreground="{StaticResource WarningColor}"
                                    Text="0/50000" />
                            </StackPanel>

                            <!--  运行时长（原有，无修改）  -->
                            <StackPanel
                                Grid.Column="4"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center">
                                <TextBlock
                                    HorizontalAlignment="Center"
                                    FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=11}"
                                    Foreground="{StaticResource TextSecondaryColor}"
                                    Text="运行时长" />
                                <TextBlock
                                    x:Name="txtRunTime"
                                    HorizontalAlignment="Center"
                                    FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=20}"
                                    FontWeight="Bold"
                                    Foreground="{StaticResource PrimaryColor}"
                                    Text="00:00:00" />
                            </StackPanel>

                            <!--  CPU 统计（新增，格式对齐原有）  -->
                            <StackPanel
                                Grid.Column="5"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center">
                                <TextBlock
                                    HorizontalAlignment="Center"
                                    FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=11}"
                                    Foreground="{StaticResource TextSecondaryColor}"
                                    Text="CPU占用/核心/线程" />
                                <!--  初始值改为占位符，格式：占用%/核心数/逻辑数  -->
                                <TextBlock
                                    x:Name="txtCPU"
                                    HorizontalAlignment="Center"
                                    FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=16}"
                                    FontWeight="Bold"
                                    Foreground="{StaticResource PrimaryColor}"
                                    Text="0.0%/0核/0线程" />
                            </StackPanel>

                            <!--  内存统计（新增，格式对齐原有）  -->
                            <StackPanel
                                Grid.Column="6"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center">
                                <TextBlock
                                    HorizontalAlignment="Center"
                                    FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=11}"
                                    Foreground="{StaticResource TextSecondaryColor}"
                                    Text="内存占用/可用/总容量" />
                                <!--  初始值改为占位符，格式：占用GB/可用GB/总量GB  -->
                                <TextBlock
                                    x:Name="txtMemory"
                                    HorizontalAlignment="Center"
                                    FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=16}"
                                    FontWeight="Bold"
                                    Foreground="{StaticResource PrimaryColor}"
                                    Text="0.0%/0.0GB/0.0GB" />
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!--  第五行：全局日志ListBox（新增 - 唯一日志展示面板）  -->
                    <ListBox
                        x:Name="lbGlobalLogs"
                        Grid.Row="2"
                        Margin="0,10,0,0"
                        HorizontalAlignment="Stretch"
                        VerticalAlignment="Stretch"
                        HorizontalContentAlignment="Stretch"
                        VerticalContentAlignment="Stretch"
                        pu:ListBoxHelper.CornerRadius="4"
                        pu:ScrollBarHelper.HoverThumbBackground="#E0E0E0"
                        pu:ScrollBarHelper.ThumbBackground="#ffb7c5"
                        pu:ScrollViewerHelper.ContentSpacing="5"
                        pu:ScrollViewerHelper.ScrollBarPosition="Outside"
                        pu:ScrollViewerHelper.ScrollBarThickness="5"
                        Background="Transparent"
                        BorderBrush="#DDDDDD"
                        BorderThickness="0"
                        FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=9}" />
                </Grid>

            </GroupBox>


        </Grid>
    </Grid>
</UserControl>