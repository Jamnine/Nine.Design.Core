<pu:WindowX
    x:Class="Nine.Design.PollingTool.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:LayoutControl="clr-namespace:Nine.Design.Clientbase;assembly=Nine.Design.Clientbase"
    xmlns:cmd="clr-namespace:Nine.Design.Clientbase;assembly=Nine.Design.Clientbase"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
    xmlns:local="clr-namespace:Nine.Design.PollingTool"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ndcui="clr-namespace:Nine.Design.UI;assembly=Nine.Design.UI"
    xmlns:pu="clr-namespace:Panuon.WPF.UI;assembly=Panuon.WPF.UI"
    xmlns:pucore="clr-namespace:Panuon.WPF;assembly=Panuon.WPF"
    xmlns:pul="https://opensource.panuon.com/wpf-ui"
    xmlns:purs="clr-namespace:Panuon.WPF.UI.Resources;assembly=Panuon.WPF.UI"
    MinWidth="1000"
    MinHeight="600"
    pu:ScrollBarHelper.HoverThumbBackground="{DynamicResource ThemeBrush}"
    pu:ScrollBarHelper.ThumbBackground="{DynamicResource ThemeBrushTrans6}"
    pu:WindowXCaption.Height="0"
    ResizeMode="CanResizeWithGrip"
    SizeChanged="MetroWindow_SizeChanged"
    WindowStartupLocation="CenterScreen"
    mc:Ignorable="d">

    <!--  全局样式统一：保留原有主题色 + 适配Panuon控件  -->
    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <!--  新项目原有资源字典  -->
                <ResourceDictionary>
                    <pu:ToastSettings x:Key="toastSetting" Spacing="0">
                        <pu:ToastSettings.LabelStyle>
                            <Style BasedOn="{StaticResource {x:Static pu:Toast.LabelStyleKey}}" TargetType="Label">
                                <Setter Property="Background" Value="#ffb7c5" />
                                <Setter Property="Foreground" Value="#FFFFFF" />
                                <Setter Property="pu:LabelHelper.CornerRadius" Value="15" />
                                <Setter Property="pu:LabelHelper.ShadowColor" Value="#ffb7c5" />
                                <Setter Property="pu:ShadowHelper.Opacity" Value="0.3" />
                            </Style>
                        </pu:ToastSettings.LabelStyle>
                    </pu:ToastSettings>
                </ResourceDictionary>
                <ResourceDictionary>
                    <FontFamily x:Key="PanuonIconFont">/Panuon.WPF.UI;component/Resources/Fonts/#PanuonIcon</FontFamily>
                </ResourceDictionary>
                <pul:StyleDictionary Includes="All" />
                <ResourceDictionary Source="pack://application:,,,/Nine.Design.UI;component/Styles/ToggleButtonStyle.xaml" />
                <ResourceDictionary Source="pack://application:,,,/Nine.Design.UI;component/Styles/SearchBoxStyle.xaml" />
                <ResourceDictionary Source="pack://application:,,,/Nine.Design.UI;component/Styles/LabelStyle.xaml" />
                <ResourceDictionary Source="pack://application:,,,/Nine.Design.UI;component/Styles/PasswordBoxStyle.xaml" />
                <ResourceDictionary Source="pack://application:,,,/Nine.Design.UI;component/Styles/GroupBoxStyle.xaml" />
                <ResourceDictionary Source="pack://application:,,,/Nine.Design.UI;component/Styles/ComboBoxStyle.xaml" />
                <ResourceDictionary Source="pack://application:,,,/Nine.Design.UI;component/Styles/TextBoxStyle.xaml" />
                <ResourceDictionary Source="pack://application:,,,/Nine.Design.UI;component/Styles/DropDownStyle.xaml" />
                <ResourceDictionary Source="pack://application:,,,/Nine.Design.UI;component/Styles/ButtonStyle.xaml" />
                <ResourceDictionary Source="pack://application:,,,/Nine.Design.UI;component/Styles/ListBoxStyle.xaml" />
                <ResourceDictionary Source="pack://application:,,,/Nine.Design.UI;component/Themes/Light.xaml" />
                <ResourceDictionary Source="pack://application:,,,/Nine.Design.UI;component/Styles/TrayMenuItemStyle.xaml" />
                <ResourceDictionary Source="pack://application:,,,/Nine.Design.UI;component/Styles/CirclePointRingLoading.xaml" />
            </ResourceDictionary.MergedDictionaries>

            <!--  原有主题色（保留不变）  -->
            <SolidColorBrush x:Key="PrimaryColor" Color="BurlyWood" />
            <SolidColorBrush x:Key="SecondaryColor" Color="#3498DB" />
            <SolidColorBrush x:Key="SuccessColor" Color="#2ECC71" />
            <SolidColorBrush x:Key="WarningColor" Color="#F39C12" />
            <SolidColorBrush x:Key="DangerColor" Color="#E74C3C" />
            <SolidColorBrush x:Key="NeutralColor" Color="#ECF0F1" />
            <SolidColorBrush x:Key="TextPrimaryColor" Color="#2C3E50" />
            <SolidColorBrush x:Key="TextSecondaryColor" Color="#7F8C8D" />

            <!--  通用样式 - 改为相对尺寸 + 适配Panuon控件  -->
            <Style x:Key="LabelStyle" TargetType="TextBlock">
                <Setter Property="Foreground" Value="{StaticResource TextSecondaryColor}" />
                <Setter Property="FontSize" Value="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=9}" />
                <Setter Property="Margin" Value="0,0,5,3" />
            </Style>

            <Style x:Key="InputStyle" TargetType="TextBox">
                <Setter Property="Padding" Value="8" />
                <Setter Property="BorderThickness" Value="1" />
                <Setter Property="BorderBrush" Value="{StaticResource SecondaryColor}" />
                <Setter Property="FontSize" Value="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=9}" />
                <Setter Property="Margin" Value="0,3,0,5" />
                <Setter Property="VerticalContentAlignment" Value="Top" />
                <!--  替换MahApps附加属性为Panuon对应实现  -->
                <Setter Property="pu:TextBoxHelper.CornerRadius" Value="4" />
                <Setter Property="pu:TextBoxHelper.FocusedBorderBrush" Value="{StaticResource PrimaryColor}" />
                <Style.Triggers>
                    <Trigger Property="IsFocused" Value="True">
                        <Setter Property="BorderBrush" Value="{StaticResource PrimaryColor}" />
                    </Trigger>
                </Style.Triggers>
            </Style>

            <Style x:Key="ButtonStyle" TargetType="Button">
                <Setter Property="Background" Value="{StaticResource SecondaryColor}" />
                <Setter Property="Foreground" Value="White" />
                <Setter Property="BorderThickness" Value="0" />
                <Setter Property="Padding" Value="12,6" />
                <Setter Property="FontSize" Value="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=9}" />
                <Setter Property="FontWeight" Value="Medium" />
                <Setter Property="Margin" Value="0,0,8,0" />
                <!--  增加Panuon按钮圆角样式  -->
                <Setter Property="pu:ButtonHelper.CornerRadius" Value="4" />
                <Style.Triggers>
                    <Trigger Property="IsMouseOver" Value="True">
                        <Setter Property="Background" Value="{StaticResource PrimaryColor}" />
                        <Setter Property="Cursor" Value="Hand" />
                    </Trigger>
                    <Trigger Property="IsPressed" Value="True">
                        <Setter Property="Background" Value="#1A5276" />
                    </Trigger>
                    <Trigger Property="IsEnabled" Value="False">
                        <Setter Property="Background" Value="{StaticResource TextSecondaryColor}" />
                        <Setter Property="Foreground" Value="LightGray" />
                    </Trigger>
                </Style.Triggers>
            </Style>

            <!--  TabItem 样式（适配Panuon，美化页面标签）  -->
            <Style x:Key="MachineTabItemStyle" TargetType="TabItem">
                <Setter Property="FontSize" Value="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=10}" />
                <Setter Property="Padding" Value="15,8" />
                <Setter Property="pu:TabItemHelper.CornerRadius" Value="4,4,0,0" />
                <Setter Property="pu:TabItemHelper.SelectedBackground" Value="{StaticResource PrimaryColor}" />
                <Setter Property="pu:TabItemHelper.SelectedForeground" Value="White" />
                <Setter Property="pu:TabItemHelper.HoverBackground" Value="#F0E6D2" />
            </Style>
        </ResourceDictionary>
    </Window.Resources>

    <!--  保留原有布局结构，移除左侧机器列表，添加TabControl多页面容器  -->
    <Grid Background="#FAFAFA">
        <Grid.RowDefinitions>
            <RowDefinition Height="50" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!--  顶部标题栏 - 相对高度（保留不变）  -->
        <Grid
            Grid.Row="0"
            Height="50"
            VerticalAlignment="Center"
            Background="{StaticResource PrimaryColor}">
            <StackPanel
                Margin="20,0,0,0"
                HorizontalAlignment="Left"
                VerticalAlignment="Center">
                <TextBlock
                    FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=13}"
                    FontWeight="Bold"
                    Foreground="White"
                    Text="轮询接口测试工具" />
                <TextBlock
                    Margin="0,2,0,0"
                    FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=8}"
                    Foreground="#E0E0E0"
                    Text="高性能多机器轮询 | 实时统计监控 | 多页面切换查看" />
            </StackPanel>
        </Grid>

        <!--  主内容区域（避开标题栏）  -->
        <Grid
            Grid.Row="1"
            Grid.ColumnSpan="2"
            Margin="9">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <!--  参数配置行  -->
                <RowDefinition Height="Auto" />
                <!--  功能按钮行  -->
                <RowDefinition Height="*" />
                <!--  TabControl多页面容器行  -->
            </Grid.RowDefinitions>

            <!--  第一行：参数配置区域 - 自适应宽度（保留不变）  -->
            <Grid Grid.Column="0" Margin="0,0,0,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="7*" />
                    <ColumnDefinition Width="5" />
                    <ColumnDefinition Width="3*" />
                </Grid.ColumnDefinitions>
                <GroupBox
                    Grid.Column="0"
                    pu:GroupBoxHelper.CornerRadius="9"
                    pu:GroupBoxHelper.HeaderBackground="#FFD0DDEE"
                    pu:GroupBoxHelper.HeaderBorderBrush="#00FFFFFF"
                    pu:GroupBoxHelper.HeaderCornerRadius="8,8,0,0"
                    pu:GroupBoxHelper.HeaderFontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=11}"
                    pu:GroupBoxHelper.HeaderHeight="35"
                    pu:GroupBoxHelper.HeaderHorizontalContentAlignment="Left"
                    pu:GroupBoxHelper.HeaderPadding="7,0,0,0"
                    BorderBrush="#FFD0DDEE"
                    Header="基础参数">
                    <Grid Grid.Row="0" Background="White">
                        <!--  左侧：基础参数  -->
                        <StackPanel>
                            <!--  频率/机器数/请求方法 - 自适应布局  -->
                            <Grid MinWidth="280">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="7*" />
                                    <ColumnDefinition Width="10" />
                                    <ColumnDefinition Width="1.5*" />
                                    <ColumnDefinition Width="10" />
                                    <ColumnDefinition Width="1.5*" />
                                    <ColumnDefinition Width="10" />
                                    <ColumnDefinition Width="2*" />
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="2*" MinHeight="50" />
                                    <RowDefinition Height="8*" MinHeight="120" />
                                </Grid.RowDefinitions>
                                <StackPanel Grid.Row="0" Grid.Column="0">
                                    <!--  轮询地址 - 自适应高度（替换MahApps Watermark为Panuon）  -->
                                    <TextBlock
                                        Margin="0,0,0,3"
                                        Style="{StaticResource LabelStyle}"
                                        Text="轮询地址：" />
                                    <TextBox
                                        x:Name="txtEndpoint"
                                        Height="30"
                                        pu:IconHelper.FontFamily="{StaticResource PanuonIconFont}"
                                        pu:ShadowHelper.BlurRadius="15"
                                        pu:ShadowHelper.Opacity="0.5"
                                        pu:ShadowHelper.ShadowDepth="5"
                                        pu:TextBoxHelper.CornerRadius="4"
                                        pu:TextBoxHelper.FocusedBorderBrush="#36AAF7"
                                        pu:TextBoxHelper.FocusedForeground="#36AAF7"
                                        pu:TextBoxHelper.FocusedShadowColor="#36AAF7"
                                        pu:TextBoxHelper.Icon="&#xe9e9;"
                                        pu:TextBoxHelper.Watermark="输入接口地址"
                                        AcceptsReturn="True"
                                        FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=9}"
                                        TextWrapping="Wrap"
                                        VerticalScrollBarVisibility="Auto" />
                                </StackPanel>
                                <!--  频率  -->
                                <StackPanel Grid.Row="0" Grid.Column="2">
                                    <TextBlock Style="{StaticResource LabelStyle}" Text="请求频率：间隔（秒）" />
                                    <pu:NumberInput
                                        x:Name="txtPollInterval"
                                        Height="30"
                                        HorizontalAlignment="Stretch"
                                        CornerRadius="5"
                                        FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=9}"
                                        Interval="1"
                                        Maximum="100"
                                        Minimum="1"
                                        Watermark="间隔（秒）" />
                                </StackPanel>

                                <!--  机器数  -->
                                <StackPanel Grid.Row="0" Grid.Column="4">
                                    <TextBlock Style="{StaticResource LabelStyle}" Text="机器数量：" />
                                    <pu:NumberInput
                                        x:Name="txtMachineCount"
                                        Height="30"
                                        HorizontalAlignment="Stretch"
                                        CornerRadius="5"
                                        FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=9}"
                                        Interval="1"
                                        Maximum="100"
                                        Minimum="1"
                                        ValueChanged="txtMachineCount_ValueChanged"
                                        Watermark="机器数量（对应页面数量）" />
                                </StackPanel>

                                <!--  请求方法  -->
                                <StackPanel Grid.Row="0" Grid.Column="6">
                                    <TextBlock Style="{StaticResource LabelStyle}" Text="请求方法：" />
                                    <StackPanel
                                        Height="30"
                                        HorizontalAlignment="Stretch"
                                        Orientation="Horizontal">
                                        <!--  均匀分布按钮  -->
                                        <RadioButton
                                            x:Name="rbGet"
                                            VerticalAlignment="Center"
                                            HorizontalContentAlignment="Center"
                                            pu:RadioButtonHelper.BoxRadius="10"
                                            pu:RadioButtonHelper.CheckedBorderBrush="#d1d6d8"
                                            pu:RadioButtonHelper.CheckedBorderThickness="8"
                                            Background="#FFFFFFFF"
                                            BorderBrush="#FFABB7CB"
                                            BorderThickness="2"
                                            FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=9}"
                                            GroupName="HttpMethod">
                                            GET
                                            <pu:RadioButtonHelper.CheckedToggleBrush>
                                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                                    <GradientStop Offset="0.0" Color="#FFFD790D" />
                                                    <GradientStop Offset="1.0" Color="#FFFFFFFF" />
                                                </LinearGradientBrush>
                                            </pu:RadioButtonHelper.CheckedToggleBrush>
                                            <pu:RadioButtonHelper.ToggleBrush>
                                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                                    <GradientStop Offset="0.0" Color="#FFE1E1E1" />
                                                    <GradientStop Offset="1.0" Color="#FFFFFFFF" />
                                                </LinearGradientBrush>
                                            </pu:RadioButtonHelper.ToggleBrush>
                                        </RadioButton>
                                        <RadioButton
                                            x:Name="rbPost"
                                            VerticalAlignment="Center"
                                            HorizontalContentAlignment="Center"
                                            pu:RadioButtonHelper.BoxRadius="10"
                                            pu:RadioButtonHelper.CheckedBorderBrush="#d1d6d8"
                                            pu:RadioButtonHelper.CheckedBorderThickness="8"
                                            Background="#FFFFFFFF"
                                            BorderBrush="#FFABB7CB"
                                            BorderThickness="2"
                                            FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=9}"
                                            GroupName="HttpMethod">
                                            POST
                                            <pu:RadioButtonHelper.CheckedToggleBrush>
                                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                                    <GradientStop Offset="0.0" Color="#FFFD790D" />
                                                    <GradientStop Offset="1.0" Color="#FFFFFFFF" />
                                                </LinearGradientBrush>
                                            </pu:RadioButtonHelper.CheckedToggleBrush>
                                            <pu:RadioButtonHelper.ToggleBrush>
                                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                                    <GradientStop Offset="0.0" Color="#FFE1E1E1" />
                                                    <GradientStop Offset="1.0" Color="#FFFFFFFF" />
                                                </LinearGradientBrush>
                                            </pu:RadioButtonHelper.ToggleBrush>
                                        </RadioButton>
                                    </StackPanel>
                                </StackPanel>
                                <StackPanel
                                    Grid.Row="1"
                                    Grid.ColumnSpan="7"
                                    Margin="0,5,0,0">
                                    <TextBlock Style="{StaticResource LabelStyle}" Text="JSON 参数：" />
                                    <TextBox
                                        x:Name="txtParametersJson"
                                        MinHeight="120"
                                        pu:IconHelper.FontFamily="{StaticResource PanuonIconFont}"
                                        pu:ShadowHelper.BlurRadius="15"
                                        pu:ShadowHelper.Opacity="0.5"
                                        pu:ShadowHelper.ShadowDepth="5"
                                        pu:TextBoxHelper.CornerRadius="4"
                                        pu:TextBoxHelper.FocusedBorderBrush="#36AAF7"
                                        pu:TextBoxHelper.FocusedForeground="#36AAF7"
                                        pu:TextBoxHelper.FocusedShadowColor="#36AAF7"
                                        pu:TextBoxHelper.Icon="&#xe9e9;"
                                        pu:TextBoxHelper.Watermark="请求参数（JSON格式，POST请求专用）"
                                        AcceptsReturn="True"
                                        FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=9}"
                                        TextWrapping="Wrap"
                                        VerticalScrollBarVisibility="Auto" />
                                </StackPanel>
                            </Grid>
                        </StackPanel>
                    </Grid>
                </GroupBox>

                <GroupBox
                    Grid.Column="2"
                    pu:GroupBoxHelper.CornerRadius="9"
                    pu:GroupBoxHelper.HeaderBackground="#FFD0DDEE"
                    pu:GroupBoxHelper.HeaderBorderBrush="#00FFFFFF"
                    pu:GroupBoxHelper.HeaderCornerRadius="8,8,0,0"
                    pu:GroupBoxHelper.HeaderFontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=11}"
                    pu:GroupBoxHelper.HeaderHeight="35"
                    pu:GroupBoxHelper.HeaderHorizontalContentAlignment="Left"
                    pu:GroupBoxHelper.HeaderPadding="7,0,0,0"
                    BorderBrush="#FFD0DDEE"
                    Header="历史记录">
                    <Grid Grid.Row="0" Background="White">
                        <!--  外层Grid：仅包含按钮和ListBox，取消多余嵌套  -->
                        <Grid Margin="0">
                            <!--  刷新按钮：固定右上角，Margin控制与边缘距离  -->
                            <Button
                                x:Name="btnLoadFromHistory"
                                Width="40"
                                Height="40"
                                Margin="0,2,20,0"
                                HorizontalAlignment="Right"
                                VerticalAlignment="Top"
                                Panel.ZIndex="111"
                                pu:ButtonHelper.CornerRadius="40,40,40,40"
                                pu:ButtonHelper.ShadowColor="#6CCF70"
                                pu:ShadowHelper.BlurRadius="15"
                                pu:ShadowHelper.ShadowDepth="3"
                                Background="#6CCF70"
                                Click="LoadFromHistory_Click"
                                Content="&#xe970;"
                                FontFamily="{StaticResource PanuonIconFont}"
                                FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=13}"
                                Foreground="#FFFFFF" />

                            <!--  ListBox：核心占满设置，取消外层Height限制，让其随父容器拉伸  -->
                            <ListBox
                                x:Name="lbHistory"
                                MaxHeight="190"
                                Margin="0"
                                Padding="0"
                                HorizontalAlignment="Stretch"
                                VerticalAlignment="Stretch"
                                HorizontalContentAlignment="Stretch"
                                VerticalContentAlignment="Stretch"
                                pu:ListBoxHelper.CornerRadius="4"
                                pu:ScrollBarHelper.HoverThumbBackground="#E0E0E0"
                                pu:ScrollBarHelper.ThumbBackground="#ffb7c5"
                                pu:ScrollViewerHelper.ContentSpacing="5"
                                pu:ScrollViewerHelper.ScrollBarPosition="Outside"
                                pu:ScrollViewerHelper.ScrollBarThickness="5"
                                Background="Transparent"
                                BorderBrush="#DDDDDD"
                                BorderThickness="0"
                                SelectionChanged="LbHistory_SelectionChanged">

                                <!--  列表项模板：保持原有  -->
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <Grid Height="28">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="80" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>
                                            <TextBlock
                                                Grid.Column="0"
                                                Margin="10,0,0,0"
                                                VerticalAlignment="Center"
                                                FontSize="11"
                                                FontWeight="Bold"
                                                Foreground="{StaticResource SecondaryColor}"
                                                Text="{Binding SavedTime, StringFormat=\{0:MM-dd HH:mm\}}" />
                                            <TextBlock
                                                Grid.Column="1"
                                                Margin="5,0,0,0"
                                                VerticalAlignment="Center"
                                                FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=9}"
                                                Foreground="{StaticResource TextPrimaryColor}"
                                                Text="{Binding Endpoint}"
                                                TextTrimming="CharacterEllipsis" />
                                        </Grid>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>

                                <!--  虚拟化面板：保持原有  -->
                                <ListBox.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <VirtualizingStackPanel Margin="0" />
                                    </ItemsPanelTemplate>
                                </ListBox.ItemsPanel>

                                <!--  核心修复：ItemContainerStyle + 重写 ControlTemplate（强制生效）  -->
                                <ListBox.ItemContainerStyle>
                                    <!--  1. BasedOn 继承 Panuon 的默认 ListBoxItem 样式，确保 Helper 生效  -->
                                    <Style BasedOn="{StaticResource {x:Type ListBoxItem}}" TargetType="ListBoxItem">
                                        <!--  基础布局：取消边距  -->
                                        <Setter Property="Margin" Value="0" />
                                        <Setter Property="Padding" Value="0" />
                                        <Setter Property="HorizontalAlignment" Value="Stretch" />
                                        <Setter Property="VerticalAlignment" Value="Center" />

                                        <!--  2. 强制设置 Panuon Helper 属性（优先级最高）  -->
                                        <Setter Property="pu:ListBoxHelper.ItemsBackground" Value="Transparent" />
                                        <Setter Property="pu:ListBoxHelper.ItemsHoverBackground" Value="#F8E5E5" />
                                        <Setter Property="pu:ListBoxHelper.ItemsHoverBorderBrush" Value="#6CCF70" />
                                        <Setter Property="pu:ListBoxHelper.ItemsHoverBorderThickness" Value="0" />
                                        <Setter Property="pu:ListBoxHelper.ItemsHoverCornerRadius" Value="4" />
                                        <Setter Property="pu:ListBoxHelper.ItemsSelectedBackground" Value="#F8E5E5" />
                                        <Setter Property="pu:ListBoxHelper.ItemsSelectedBorderBrush" Value="Transparent" />
                                        <Setter Property="pu:ListBoxHelper.ItemsSelectedBorderThickness" Value="0" />
                                        <Setter Property="pu:ListBoxHelper.ItemsSelectedCornerRadius" Value="4" />

                                        <!--  3. 重写 ControlTemplate（彻底摆脱默认样式干扰，核心！）  -->
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="ListBoxItem">
                                                    <Grid
                                                        x:Name="RootGrid"
                                                        Background="{TemplateBinding Background}"
                                                        SnapsToDevicePixels="True">
                                                        <!--  绑定 Panuon Helper 的背景/边框/圆角  -->
                                                        <Border
                                                            x:Name="ItemBorder"
                                                            Background="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=(pu:ListBoxHelper.ItemsBackground)}"
                                                            BorderBrush="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=(pu:ListBoxHelper.ItemsBorderBrush)}"
                                                            BorderThickness="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=(pu:ListBoxHelper.ItemsBorderThickness)}"
                                                            CornerRadius="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=(pu:ListBoxHelper.ItemsCornerRadius)}"
                                                            SnapsToDevicePixels="True">
                                                            <!--  内容容器：显示 ItemTemplate  -->
                                                            <ContentPresenter
                                                                Margin="{TemplateBinding Padding}"
                                                                HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                                                VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                                                Focusable="False"
                                                                SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" />
                                                        </Border>
                                                    </Grid>

                                                    <!--  4. 触发器：手动实现 Hover/Selected 状态（不依赖 Panuon 自动触发）  -->
                                                    <ControlTemplate.Triggers>
                                                        <!--  悬浮状态  -->
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter TargetName="ItemBorder" Property="Background" Value="#ffb7c5" />
                                                            <Setter TargetName="ItemBorder" Property="BorderBrush" Value="#6CCF70" />
                                                            <Setter TargetName="ItemBorder" Property="BorderThickness" Value="0" />
                                                            <Setter TargetName="ItemBorder" Property="CornerRadius" Value="4" />
                                                        </Trigger>

                                                        <!--  选中状态  -->
                                                        <Trigger Property="IsSelected" Value="True">
                                                            <Setter TargetName="ItemBorder" Property="Background" Value="#F8E5E5" />
                                                            <Setter TargetName="ItemBorder" Property="BorderBrush" Value="Transparent" />
                                                            <Setter TargetName="ItemBorder" Property="BorderThickness" Value="0" />
                                                            <Setter TargetName="ItemBorder" Property="CornerRadius" Value="4" />
                                                        </Trigger>

                                                        <!--  禁用状态（可选）  -->
                                                        <Trigger Property="IsEnabled" Value="False">
                                                            <Setter TargetName="ItemBorder" Property="Opacity" Value="0.5" />
                                                        </Trigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </ListBox.ItemContainerStyle>
                            </ListBox>
                        </Grid>
                    </Grid>
                </GroupBox>
            </Grid>

            <!--  第二行：功能按钮区域（保留不变）  -->
            <StackPanel
                Grid.Row="1"
                Margin="20,0,20,15"
                HorizontalAlignment="Right"
                Orientation="Horizontal">

                <Button
                    x:Name="btnStartPolling"
                    MinWidth="100"
                    MaxWidth="140"
                    Background="{StaticResource SuccessColor}"
                    Click="StartPolling_Click"
                    Content="开始轮询"
                    Style="{StaticResource ButtonStyle}" />
                <Button
                    x:Name="btnStopPolling"
                    MinWidth="100"
                    MaxWidth="140"
                    Background="{StaticResource DangerColor}"
                    Click="StopPolling_Click"
                    Content="停止轮询"
                    Style="{StaticResource ButtonStyle}" />
                <Button
                    x:Name="btnClearLogs"
                    MinWidth="100"
                    MaxWidth="140"
                    Background="{StaticResource WarningColor}"
                    Click="ClearLogs_Click"
                    Content="清空日志"
                    Style="{StaticResource ButtonStyle}" />
            </StackPanel>

            <!--  第三行：多页面容器（TabControl）- 核心新增，替换原有左侧列表+右侧统计日志  -->
            <TabControl
                x:Name="tcMachineOverview"
                Grid.Row="2"
                Margin="20,0,20,20"
                ItemContainerStyle="{StaticResource MachineTabItemStyle}"
                Style="{StaticResource {x:Type TabControl}}">
                <!--  每个 TabItem 包含 统计面板 + 日志列表，与原有右侧结构一致  -->
                <TabControl.ItemTemplate>
                    <DataTemplate>
                        <TextBlock Text="{Binding TabTitle}" />
                    </DataTemplate>
                </TabControl.ItemTemplate>
                <TabControl.ContentTemplate>
                    <DataTemplate>
                        <Grid Margin="0">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="auto" MinHeight="80" />
                                <!--  统计面板  -->
                                <RowDefinition Height="*" />
                                <!--  日志列表  -->
                            </Grid.RowDefinitions>

                            <!--  实时统计面板  -->
                            <Border
                                Grid.Row="0"
                                Padding="10"
                                Background="White"
                                BorderBrush="{StaticResource SecondaryColor}"
                                BorderThickness="1"
                                CornerRadius="6">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>

                                    <!--  总请求数  -->
                                    <StackPanel
                                        Grid.Column="0"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center">
                                        <TextBlock
                                            HorizontalAlignment="Center"
                                            FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=11}"
                                            Foreground="{StaticResource TextSecondaryColor}"
                                            Text="总请求数" />
                                        <TextBlock
                                            x:Name="txtTabTotalRequests"
                                            HorizontalAlignment="Center"
                                            FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=20}"
                                            FontWeight="Bold"
                                            Foreground="{StaticResource PrimaryColor}"
                                            Text="{Binding MachineData.TotalRequests}" />
                                    </StackPanel>

                                    <!--  成功请求数  -->
                                    <StackPanel
                                        Grid.Column="1"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center">
                                        <TextBlock
                                            HorizontalAlignment="Center"
                                            FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=11}"
                                            Foreground="{StaticResource TextSecondaryColor}"
                                            Text="成功请求数" />
                                        <TextBlock
                                            x:Name="txtTabSuccessRequests"
                                            HorizontalAlignment="Center"
                                            FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=20}"
                                            FontWeight="Bold"
                                            Foreground="{StaticResource SuccessColor}"
                                            Text="{Binding MachineData.SuccessRequests}" />
                                    </StackPanel>

                                    <!--  成功率  -->
                                    <StackPanel
                                        Grid.Column="2"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center">
                                        <TextBlock
                                            HorizontalAlignment="Center"
                                            FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=11}"
                                            Foreground="{StaticResource TextSecondaryColor}"
                                            Text="成功率" />
                                        <TextBlock
                                            x:Name="txtTabSuccessRate"
                                            HorizontalAlignment="Center"
                                            FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=20}"
                                            FontWeight="Bold"
                                            Foreground="{StaticResource SecondaryColor}">
                                            <TextBlock.Text>
                                                <MultiBinding Converter="{local:SuccessRateConverter}">
                                                    <Binding Path="MachineData.TotalRequests" />
                                                    <Binding Path="MachineData.SuccessRequests" />
                                                </MultiBinding>
                                            </TextBlock.Text>
                                        </TextBlock>
                                    </StackPanel>

                                    <!--  端口占用数（仅总览页面显示，单机器页面隐藏）  -->
                                    <StackPanel
                                        Grid.Column="3"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"
                                        Visibility="{Binding MachineId, Converter={local:TabVisibilityConverter}}">
                                        <TextBlock
                                            HorizontalAlignment="Center"
                                            FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=11}"
                                            Foreground="{StaticResource TextSecondaryColor}"
                                            Text="端口占用数" />
                                        <TextBlock
                                            x:Name="txtTabPortUsage"
                                            HorizontalAlignment="Center"
                                            FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=20}"
                                            FontWeight="Bold"
                                            Foreground="{StaticResource WarningColor}"
                                            Text="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=CurrentPortCount, StringFormat=\{0\}/50000}" />
                                    </StackPanel>

                                    <!--  运行时长（仅总览页面显示，单机器页面隐藏）  -->
                                    <StackPanel
                                        Grid.Column="4"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"
                                        Visibility="{Binding MachineId, Converter={local:TabVisibilityConverter}}">
                                        <TextBlock
                                            HorizontalAlignment="Center"
                                            FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=11}"
                                            Foreground="{StaticResource TextSecondaryColor}"
                                            Text="运行时长" />
                                        <TextBlock
                                            x:Name="txtTabRunTime"
                                            HorizontalAlignment="Center"
                                            FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=20}"
                                            FontWeight="Bold"
                                            Foreground="{StaticResource PrimaryColor}"
                                            Text="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=RunTime, StringFormat=\{0:hh\\:mm\\:ss\}}" />
                                    </StackPanel>
                                </Grid>
                            </Border>

                            <!--  日志区域  -->
                            <Grid Grid.Row="1" Margin="0,10,0,0">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="40" />
                                    <!--  日志标题  -->
                                    <RowDefinition Height="*" />
                                    <!--  日志列表  -->
                                </Grid.RowDefinitions>

                                <!--  日志标题  -->
                                <Border
                                    Grid.Row="0"
                                    Padding="10"
                                    Background="{StaticResource PrimaryColor}"
                                    CornerRadius="6,6,0,0">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock
                                            FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=11}"
                                            FontWeight="SemiBold"
                                            Foreground="White"
                                            Text="{Binding TabTitle, StringFormat=\{0\} 日志}" />
                                        <TextBlock
                                            Margin="10,0,0,0"
                                            VerticalAlignment="Center"
                                            FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=9}"
                                            Foreground="#E0E0E0"
                                            Text="（实时输出请求详情）" />
                                    </StackPanel>
                                </Border>

                                <!--  日志列表（每个页面独立日志）  -->
                                <ListBox
                                    x:Name="lbTabLogs"
                                    Grid.Row="1"
                                    Padding="10"
                                    pu:ListBoxHelper.CornerRadius="0,0,6,6"
                                    Background="White"
                                    BorderBrush="{StaticResource SecondaryColor}"
                                    BorderThickness="1,0,1,1"
                                    FontFamily="Consolas"
                                    FontSize="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=FontSize, Converter={local:ScaleConverter}, ConverterParameter=10}"
                                    ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                    ScrollViewer.VerticalScrollBarVisibility="Auto">
                                    <ListBox.Resources>
                                        <Style TargetType="ListBoxItem">
                                            <Setter Property="Padding" Value="2" />
                                            <Setter Property="Margin" Value="0,1" />
                                            <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate TargetType="ListBoxItem">
                                                        <Border
                                                            Padding="5"
                                                            Background="{TemplateBinding Background}"
                                                            CornerRadius="3">
                                                            <ContentPresenter />
                                                        </Border>
                                                        <ControlTemplate.Triggers>
                                                            <Trigger Property="IsSelected" Value="True">
                                                                <Setter Property="Background" Value="#E3F2FD" />
                                                            </Trigger>
                                                        </ControlTemplate.Triggers>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                        </Style>
                                    </ListBox.Resources>
                                </ListBox>
                            </Grid>
                        </Grid>
                    </DataTemplate>
                </TabControl.ContentTemplate>
            </TabControl>
        </Grid>
    </Grid>
</pu:WindowX>